<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Safepay RAAST Demo</title>

  <link rel="stylesheet" href="./css/app.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
  <div class="app">

    <!-- LEFT -->
    <aside class="leftPane">
      <div class="brandWrap">
        <h1>Safepay RAAST RTPs &amp; QR Demo</h1>

        <!-- LEFT: QR Preview (only in QR mode) -->
        <div id="qrWrap" class="leftPanel qrWrap isHidden">
          <div class="qrTitle">QR Preview</div>
          <div id="qrCanvas" class="qrCanvas"></div>
          <textarea id="qrPayload" class="qrPayload" readonly placeholder="QR payload will appear here…"></textarea>
        </div>

        <!-- LEFT: RTP Response (only in RTP mode) -->
        <div id="rtpRespWrap" class="leftPanel isHidden">
          <section class="card">
            <div class="row" style="align-items:flex-start;">
              <div style="flex:0 0 auto;">
                <label>Status</label>
                <div id="statusPill" class="pill">—</div>
              </div>
              <div style="flex:1;">
                <label>Response</label>
                <textarea id="responseBox" class="mono" readonly placeholder="Response will appear here…"></textarea>
              </div>
            </div>
          </section>
        </div>

        <!-- LEFT: BULK Results (only in BULK mode) -->
        <div id="bulkRespWrap" class="leftPanel isHidden" aria-hidden="true">
          <section class="card">
            <div class="cardHeader">
              <h2>Batch Results</h2>
              <div id="csvStatus" class="small"></div>
            </div>

            <div class="tableWrap tableWrapLeft">
              <table id="resultsTable" style="display:none;">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Mode/Type</th>
                    <th>Merchant</th>
                    <th>Amount</th>
                    <th>Debitor</th>
                    <th>HTTP</th>
                    <th>Result</th>
                    <th>QR</th>
                  </tr>
                </thead>
                <tbody id="resultsBody"></tbody>
              </table>
            </div>
          </section>
        </div>
      </div>

      <!-- Left pane footer -->
      <div class="footerNote">
        Powered by <img src="/css/Safepay-White-Logo.png" width="100" alt="Safepay" />
      </div>
    </aside>

    <!-- RIGHT -->
    <main class="rightPane">
      <!-- TOP TABS -->
      <div class="topTabs">
        <button id="modeRtp" class="toggle active" type="button">RTP</button>
        <button id="modeQr" class="toggle" type="button">QR</button>
        <button id="modeBulk" class="toggle" type="button">Bulk Attempts</button>
      </div>

      <!-- SINGLE (RTP/QR) CONTROLS -->
      <div id="singleSection" class="panel">
        <section class="card">
          <label>aggregator_merchant_identifier</label>
          <input id="merchantId" placeholder="am_..." />

          <div class="row">
            <div>
              <label>amount</label>
              <input id="amount" type="number" min="1" step="1" placeholder="e.g. 10000" />
            </div>

            <!-- RTP type (RTP-only) -->
            <div id="rtpTypeWrap" class="rtpOnly">
              <label>RTP Type</label>
              <select id="rtpType">
                <option value="RTP_NOW">RTP NOW</option>
                <option value="RTP_LATER">RTP LATER</option>
              </select>
            </div>
          </div>

          <!-- Debitor (RTP-only) -->
          <div class="row rtpOnly" id="debitorRow">
            <div>
              <label>Debitor Type</label>
              <select id="debitorType">
                <option value="IBAN">IBAN</option>
                <option value="RAAST_ID">RAAST ID</option>
                <option value="VAULT_TOKEN">Vault Token</option>
              </select>
            </div>
            <div>
              <label id="debitorLabel">Debitor (IBAN)</label>
              <input id="debitorValue" placeholder="PK.." />
            </div>
          </div>

          <div class="row">
            <div>
              <label>order_id</label>
              <input id="orderId" placeholder="Bulk-test1" />
            </div>
            <div>
              <label>request_id (UUID)</label>
              <input id="requestId" class="mono" />
            </div>
          </div>

          <div class="btnbar">
            <button id="sendBtn" class="primary" type="button">Send</button>
            <button id="regenBtn" class="secondary" type="button">New UUID</button>
            <button id="clearBtn" class="danger" type="button">Clear</button>
          </div>
        </section>
      </div>

      <!-- BULK CONTROLS (upload + run only; table is on the LEFT) -->
      <div id="bulkSection" class="panel isHidden" aria-hidden="true">
        <section class="card">
          <div class="cardHeader">
            <h2>CSV / TSV Batch</h2>
            <div class="small">Paste/export from Excel → TSV works best (tab-separated).</div>
          </div>

          <div class="row">
            <div>
              <label>Upload (.tsv or .csv)</label>
              <input id="csvFile" type="file" accept=".tsv,.csv,text/tab-separated-values,text/csv" />
              <div class="small" style="margin-top:6px;">
                RTP file format:
                <span class="mono">merchant, amount, RTP_NOW/RTP_LATER, debitor_type, debitor_value, order_id, request_id(optional)</span>
                <br/>
                QR file format:
                <span class="mono">merchant, amount, QR, order_id, request_id(optional)</span>
              </div>
            </div>
          </div>

          <div class="btnbar">
            <button id="csvRun" class="primary" type="button">Run Batch</button>
            <button id="csvClear" class="danger" type="button">Clear Results</button>
          </div>
        </section>
      </div>

    </main>
  </div>

  <script type="module" src="./js/app.js"></script>
</body>
</html>