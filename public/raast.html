<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Safepay RAAST Demo</title>

    <link rel="stylesheet" href="/css/app.css" />

    <!-- QR lib (existing dependency) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  </head>

  <body>
    <div class="app">
      <!-- LEFT PANE -->
      <div class="leftPane">
        <div class="brandWrap">
          <h1>Safepay RAAST RTPs & QR Demo</h1>
          <p>Local demo UI to test RTPs, QRs, and Payouts.</p>

          <!-- QR hero (only visible in QR tab) -->
          <div id="qrWrap" class="leftPanel">
            <div class="qrTitle">QR Preview</div>
            <div id="qrCanvas"></div>

            <label class="small">QR Payload</label>
            <textarea id="qrPayload" class="mono" readonly></textarea>
          </div>

          <!-- RTP / PAYOUT response JSON (visible in RTP & PAYOUT) -->
          <div id="rtpRespWrap" class="leftPanel">
            <div class="row" style="align-items: center; gap: 12px">
              <div>
                <div class="small">Status</div>
                <div id="statusPill" class="pill">—</div>
              </div>
            </div>

            <label>Response</label>
            <textarea id="responseBox" class="mono" readonly></textarea>
          </div>

          <!-- Bulk results table (visible in BULK) -->
          <div id="bulkRespWrap" class="leftPanel tableWrapLeft isHidden" aria-hidden="true">
            <h2>Batch Results</h2>
            <table id="resultsTable" style="display: none">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Mode/Type</th>
                  <th>Merchant</th>
                  <th>Amount</th>
                  <th>Debitor / Creditor</th>
                  <th>HTTP</th>
                  <th>Result</th>
                  <th>QR</th>
                </tr>
              </thead>
              <tbody id="resultsBody"></tbody>
            </table>

            <div id="csvStatus" class="small"></div>
          </div>
        </div>

        <div class="footerNote">
          Powered by <img src="/css/Safepay-White-Logo.png" alt="Safepay" height="18" />
        </div>
      </div>

      <!-- RIGHT PANE -->
      <div class="rightPane">
        <div class="topTabs">
          <button id="modeRtp" class="toggle">RTP</button>
          <button id="modeQr" class="toggle">QR</button>
          <button id="modePayout" class="toggle">Payout</button>
          <button id="modeBulk" class="toggle">Bulk Attempts</button>
        </div>

        <!-- SINGLE (RTP / QR / PAYOUT) -->
        <div id="singleSection" class="panel">
          <div class="card">
            <div id="merchantWrap">
              <label>aggregator_merchant_identifier</label>
              <input id="merchantId" placeholder="am_xxx" />
            </div>

            <div id="amountWrap">
              <label>amount</label>
              <input id="amount" placeholder="2000" />
            </div>

            <!-- RTP-only -->
            <div id="rtpTypeWrap" class="rtpOnly">
              <label>RTP Type</label>
              <select id="rtpType">
                <option value="RTP_NOW">RTP NOW</option>
                <option value="RTP_LATER">RTP LATER</option>
              </select>
            </div>

            <!-- QR-only -->
            <div id="qrTypeWrap" class="rtpOnly isHidden">
              <label>QR Type</label>
              <select id="qrType">
                <option value="DYNAMIC">DYNAMIC</option>
                <option value="STATIC">STATIC</option>
              </select>
            </div>

            <!-- RTP-only -->
            <div class="rtpOnly">
              <label>Debitor Type</label>
              <select id="debitorType">
                <option value="IBAN">IBAN</option>
                <option value="RAAST_ID">RAAST ID</option>
                <option value="VAULT_TOKEN">Vault Token</option>
              </select>
            </div>

            <div class="rtpOnly">
              <label id="debitorLabel">Debitor (IBAN)</label>
              <input id="debitorValue" placeholder="PK.." />
            </div>

            <!-- PAYOUT-only -->
            <div id="creditorWrap" class="payoutOnly isHidden">
              <label>creditor_iban</label>
              <input id="creditorIban" placeholder="PK39HABB0007867916713101" />
            </div>

            <!-- order_id (RTP/QR only) -->
            <div id="orderWrap">
              <label>order_id</label>
              <input id="orderId" placeholder="order-001" />
            </div>

            <div>
              <label>request_id (UUID)</label>
              <input id="requestId" class="mono" />
            </div>

            <div class="btnbar">
              <button id="sendBtn" class="primary">Send</button>
              <button id="regenBtn" class="secondary">New UUID</button>
              <button id="clearBtn" class="danger">Clear</button>
            </div>
          </div>
        </div>

        <!-- BULK -->
        <div id="bulkSection" class="panel isHidden" aria-hidden="true">
          <div class="card">
            <h2>CSV / TSV Batch</h2>
            <p class="small">Paste/export from Excel → TSV works best (tab-separated).</p>

            <label>Upload (.tsv or .csv)</label>
            <input id="csvFile" type="file" accept=".csv,.tsv,text/csv,text/tab-separated-values" />

            <div class="small" style="margin-top: 10px">
              <div><b>RTP file format:</b> merchant, amount, RTP_NOW/RTP_LATER, debitor_type, debitor_value, order_id, request_id(optional)</div>
              <div><b>QR file format:</b> merchant, amount, QR, order_id, request_id(optional)</div>
              <div><b>PAYOUT file format:</b> amount, creditor_iban</div>
            </div>

            <div class="btnbar">
              <button id="csvRun" class="primary">Run Batch</button>
              <button id="csvClear" class="danger">Clear Results</button>
            </div>

            <div class="footerNoteRight">RAAST Demo UI • local-only • backend holds secrets</div>
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="/js/app.js"></script>
  </body>
</html>
